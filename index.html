<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEN Z Airdrop - Mining Site</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; background: #1a1a1a; color: white; font-family: Arial, sans-serif; }
        .container { max-width: 900px; margin: 50px auto; padding: 30px; background: rgba(0, 0, 0, 0.85); border-radius: 12px; box-shadow: 0px 10px 30px rgba(0, 255, 0, 0.2); }
        h1 { color: #00ff00; text-transform: uppercase; }
        input, button { padding: 12px; margin: 10px 0; border-radius: 8px; border: none; font-size: 16px; }
        button { background: #00ff00; color: black; cursor: pointer; }
        button:hover { background: #33cc33; }
        .hidden { display: none; }
        .profile-header { position: fixed; top: 10px; right: 20px; background: rgba(0, 0, 0, 0.7); padding: 10px; border-radius: 12px; box-shadow: 0px 4px 15px rgba(0, 255, 0, 0.4); }
    </style>
</head>
<body>
    <div class="container">
        <h1>GEN Z Airdrop - Mining Site</h1>
        <div id="authForm">
            <h2>Login / Signup</h2>
            <input type="email" id="email" placeholder="Enter Email" required>
            <input type="password" id="password" placeholder="Enter Password" required>
            <button onclick="authenticate()">Login / Signup</button>
        </div>
        <div id="dashboard" class="hidden">
            <div class="profile-header">
                <span id="profileName"></span> | Balance: <span id="balance">0.00</span> GEN
                <button onclick="logout()">Logout</button>
            </div>
            <h2>Start Mining</h2>
            <button id="startMiningBtn" onclick="startMining()">Start Mining</button>
            <div id="miningStatus" class="hidden">Mining in Progress...</div>
            <h2>Wallet</h2>
            <button onclick="withdraw()">Withdraw</button>
            <button onclick="deposit()">Deposit</button>
            <h2>Referral System</h2>
            <button onclick="getReferralLink()">Get Referral Link</button>
            <h2>Leaderboard</h2>
            <button onclick="viewLeaderboard()">View Top Miners</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCaqIi2f6ERwCcXijAt6ZyyovUz2A0eJ7k",
            authDomain: "tape-17372.firebaseapp.com",
            databaseURL: "https://tape-17372-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "tape-17372",
            storageBucket: "tape-17372.firebasestorage.app",
            messagingSenderId: "727441052587",
            appId: "1:727441052587:web:6be3489d0869be4e4a78ee",
            measurementId: "G-PHC8B2P84G"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const firestore = firebase.firestore();
        let loggedIn = false;
        let balance = 0;

        // Check for user login state on page load
        window.onload = function() {
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    loggedIn = true;
                    document.getElementById("profileName").innerText = user.email;
                    getBalanceFromFirestore(user.uid);
                    document.getElementById("authForm").classList.add("hidden");
                    document.getElementById("dashboard").classList.remove("hidden");
                } else {
                    loggedIn = false;
                    document.getElementById("authForm").classList.remove("hidden");
                    document.getElementById("dashboard").classList.add("hidden");
                }
            });
        };

        // Sign-up or Login Function
        function authenticate() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            if (!loggedIn) {
                // Register a new user
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        loggedIn = true;
                        alert("Account created successfully!");
                        saveBalanceToFirestore(userCredential.user.uid, 0); // Set initial balance
                    })
                    .catch((error) => {
                        // If user already exists, just log them in
                        if (error.code === "auth/email-already-in-use") {
                            auth.signInWithEmailAndPassword(email, password)
                                .then((userCredential) => {
                                    loggedIn = true;
                                    alert("Logged in successfully!");
                                    getBalanceFromFirestore(userCredential.user.uid);
                                })
                                .catch((error) => {
                                    alert(error.message);
                                });
                        } else {
                            alert(error.message);
                        }
                    });
            }
        }

        // Get balance from Firestore
        function getBalanceFromFirestore(uid) {
            firestore.collection("users").doc(uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        balance = doc.data().balance;
                        document.getElementById("balance").innerText = balance.toFixed(2);
                    }
                })
                .catch((error) => {
                    console.log("Error getting balance:", error);
                });
        }

        // Save balance to Firestore
        function saveBalanceToFirestore(uid, newBalance) {
            firestore.collection("users").doc(uid).set({
                balance: newBalance
            }).then(() => {
                console.log("Balance saved to Firestore");
            }).catch((error) => {
                console.log("Error saving balance:", error);
            });
        }

        // Start Mining
        function startMining() {
            if (loggedIn) {
                setInterval(() => {
                    balance += 0.005;
                    document.getElementById("balance").innerText = balance.toFixed(2);
                    saveBalanceToFirestore(auth.currentUser.uid, balance); // Update Firestore balance
                }, 5000);
            } else {
                alert("Please log in to start mining.");
            }
        }

        // Withdraw
        function withdraw() {
            if (balance >= 10) {
                balance -= 10;
                document.getElementById("balance").innerText = balance.toFixed(2);
                saveBalanceToFirestore(auth.currentUser.uid, balance); // Update Firestore balance
                alert("Withdrawal successful! 10 GEN deducted.");
            } else {
                alert("Insufficient balance! Minimum 10 GEN required.");
            }
        }

        // Deposit
        function deposit() {
            let depositAmount = prompt("Enter amount to deposit:");
            depositAmount = parseFloat(depositAmount);
            if (!isNaN(depositAmount) && depositAmount > 0) {
                balance += depositAmount;
                document.getElementById("balance").innerText = balance.toFixed(2);
                saveBalanceToFirestore(auth.currentUser.uid, balance); // Update Firestore balance
                alert("Deposit successful!");
            } else {
                alert("Invalid deposit amount.");
            }
        }

        // Referral Link
        function getReferralLink() {
            let refLink = `https://genzairdrop.com/?ref=${auth.currentUser.email}`;
            alert("Your referral link: " + refLink);
        }

        // View Leaderboard
        function viewLeaderboard() {
            alert("Leaderboard feature coming soon!");
        }

        // Logout
        function logout() {
            auth.signOut().then(() => {
                loggedIn = false;
                document.getElementById("authForm").classList.remove("hidden");
                document.getElementById("dashboard").classList.add("hidden");
            }).catch((error) => {
                alert(error.message);
            });
        }
    </script>
</body>
</html>
