<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEN Z Airdrop - Mining Site</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; background: #1a1a1a; color: white; font-family: Arial, sans-serif; }
        .container { max-width: 900px; margin: 50px auto; padding: 30px; background: rgba(0, 0, 0, 0.85); border-radius: 12px; box-shadow: 0px 10px 30px rgba(0, 255, 0, 0.2); }
        h1 { color: #00ff00; text-transform: uppercase; }
        input, button { padding: 12px; margin: 10px 0; border-radius: 8px; border: none; font-size: 16px; }
        button { background: #00ff00; color: black; cursor: pointer; }
        button:hover { background: #33cc33; }
        .hidden { display: none; }
        .profile-header { position: fixed; top: 10px; right: 20px; background: rgba(0, 0, 0, 0.7); padding: 10px; border-radius: 12px; box-shadow: 0px 4px 15px rgba(0, 255, 0, 0.4); }
    </style>
</head>
<body>
    <div class="container">
        <h1>GEN Z Airdrop - Mining Site</h1>
        <div id="authForm">
            <h2>Login / Signup</h2>
            <input type="email" id="email" placeholder="Enter Email" required>
            <input type="password" id="password" placeholder="Enter Password" required>
            <button onclick="authenticate()">Login / Signup</button>
        </div>
        <div id="dashboard" class="hidden">
            <div class="profile-header">
                <span id="profileName"></span> | Balance: <span id="balance">0.00</span> GEN
                <button onclick="logout()">Logout</button>
            </div>
            <h2>Start Mining</h2>
            <button id="startMiningBtn" onclick="startMining()">Start Mining</button>
            <div id="miningStatus" class="hidden">Mining in Progress...</div>
            <h2>Wallet</h2>
            <button onclick="withdraw()">Withdraw</button>
            <button onclick="deposit()">Deposit</button>
            <h2>Referral System</h2>
            <button onclick="getReferralLink()">Get Referral Link</button>
            <h2>Leaderboard</h2>
            <button onclick="viewLeaderboard()">View Top Miners</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCaqIi2f6ERwCcXijAt6ZyyovUz2A0eJ7k",
            authDomain: "tape-17372.firebaseapp.com",
            databaseURL: "https://tape-17372-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "tape-17372",
            storageBucket: "tape-17372.firebasestorage.app",
            messagingSenderId: "727441052587",
            appId: "1:727441052587:web:6be3489d0869be4e4a78ee",
            measurementId: "G-PHC8B2P84G"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        let loggedIn = false;
        let balance = parseFloat(localStorage.getItem('balance')) || 0;
        let miningInterval;

        window.onload = function() {
            if (localStorage.getItem('username')) {
                loggedIn = true;
                document.getElementById("profileName").innerText = localStorage.getItem('username');
                document.getElementById("balance").innerText = balance.toFixed(2);
                document.getElementById("authForm").classList.add("hidden");
                document.getElementById("dashboard").classList.remove("hidden");
            }
        };

        function authenticate() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            // Sign up or login
            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    localStorage.setItem('username', email);
                    localStorage.setItem('balance', balance);
                    alert("Account created successfully!");
                    loggedIn = true;
                    document.getElementById("profileName").innerText = email;
                    document.getElementById("authForm").classList.add("hidden");
                    document.getElementById("dashboard").classList.remove("hidden");
                })
                .catch((error) => {
                    // If user exists, login instead
                    signInWithEmailAndPassword(auth, email, password)
                        .then((userCredential) => {
                            const user = userCredential.user;
                            localStorage.setItem('username', email);
                            loggedIn = true;
                            document.getElementById("profileName").innerText = email;
                            document.getElementById("authForm").classList.add("hidden");
                            document.getElementById("dashboard").classList.remove("hidden");
                        })
                        .catch((error) => {
                            alert("Incorrect password! Try again.");
                        });
                });
        }

        function startMining() {
            if (!miningInterval) {
                miningInterval = setInterval(() => {
                    balance += 0.005;
                    localStorage.setItem('balance', balance);
                    document.getElementById("balance").innerText = balance.toFixed(2);
                }, 5000);
                document.getElementById("miningStatus").classList.remove("hidden");
            } else {
                alert("Mining already in progress.");
            }
        }

        function withdraw() {
            if (balance >= 10) {
                balance -= 10;
                localStorage.setItem('balance', balance);
                document.getElementById("balance").innerText = balance.toFixed(2);
                alert("Withdrawal successful! 10 GEN deducted.");
            } else {
                alert("Insufficient balance! Minimum 10 GEN required.");
            }
        }

        function deposit() {
            let depositAmount = prompt("Enter amount to deposit:");
            depositAmount = parseFloat(depositAmount);
            if (!isNaN(depositAmount) && depositAmount > 0) {
                balance += depositAmount;
                localStorage.setItem('balance', balance);
                document.getElementById("balance").innerText = balance.toFixed(2);
                alert("Deposit successful!");
            } else {
                alert("Invalid deposit amount.");
            }
        }

        function getReferralLink() {
            let refUsername = localStorage.getItem('username');
            let refLink = `https://genzairdrop.com/?ref=${refUsername}`;
            alert("Your referral link: " + refLink);
        }

        function viewLeaderboard() {
            let users = JSON.parse(localStorage.getItem('users')) || {};
            users[localStorage.getItem('username')] = balance;
            localStorage.setItem('users', JSON.stringify(users));

            let sortedUsers = Object.entries(users).sort((a, b) => b[1] - a[1]);
            let leaderboardMsg = "🏆 Leaderboard 🏆\n";
            sortedUsers.forEach(([user, bal], index) => {
                leaderboardMsg += `${index + 1}. ${user} - ${bal.toFixed(2)} GEN\n`;
            });

            alert(leaderboardMsg);
        }

        function logout() {
            // Clear Firebase user session
            signOut(auth).then(() => {
                localStorage.removeItem('username');
                localStorage.removeItem('balance');
                location.reload(); // Reload to show login form
            }).catch((error) => {
                console.error("Error signing out: ", error);
            });
        }
    </script>
</body>
</html>
